<!DOCTYPE html>

<script type="text/javascript" charset="utf-8">
	safari.application.addEventListener( 'message', handle_message, true );
	
	function handle_message( msgEvent ) {
		// console.log( 'Message received by global.html' );
		
		switch( msgEvent.name ) {
			case 'subscribe':
				// console.log( 'Subscribing to ' + msgEvent.message );
				
				base_uri = safari.extension.settings.getItem( 'igoogle' )
					? 'http://www.google.com/ig/add'
					: 'http://www.google.com/ig/addtoreader';
				feed_uri = msgEvent.message.replace( /^feed:(http(s):)?\/\//, 'http$2://' );
				
				// console.log( '  --> Redirecting to ' + base_uri + '?feedurl=' + feed_uri );
				safari.application.activeBrowserWindow.activeTab.url = base_uri + '?feedurl=' + feed_uri;
				break;
		}
	}
</script>
